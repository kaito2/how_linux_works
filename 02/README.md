## Execute

```
$ gcc -o hello hello.c
$ ./hello
hello world
$ sudo dtruss ./hello
...
# エラーになるはず
```

本書に書かれている `strace` を Mac で再現するには `dtruss` を使用する必要がある。

しかし、 `dtruss` を使用するためには以下のリンクのような設定を行う必要があるらしい。

リカバリモードで起動するまでやりたくないので今回はスキップ!!!

[dtrussでgolangのシステムコールをトレースしたい - Qiita](https://qiita.com/yurakawa/items/2ab084a2f3f0aa0bf0c7)


```
$ docker run --rm -it ubuntu:18.04 /bin/bash
# apt-get update
# apt-get install sysstat
# sar -P ALL 1
Linux 4.9.184-linuxkit (048be7bc09e0) 	04/17/20 	_x86_64_	(6 CPU)

13:25:21        CPU     %user     %nice   %system   %iowait    %steal     %idle
13:25:22        all      0.71      0.00      3.88      9.35      0.00     86.07
13:25:22          0      0.00      0.00      0.00      0.00      0.00    100.00
13:25:22          1      1.02      0.00      3.06      0.00      0.00     95.92
13:25:22          2      0.00      0.00     12.90     56.99      0.00     30.11
13:25:22          3      1.03      0.00      3.09      0.00      0.00     95.88
13:25:22          4      1.06      0.00      1.06      0.00      0.00     97.87
13:25:22          5      1.04      0.00      3.12      0.00      0.00     95.83
...


```

## 仕切り直し

```
$ docker build -t sandbox .
$ docker run --rm -it -v `pwd`:/workspace sandbox
```

p.19

以下を見れば分かる通り、 `loop.c` のコードはシステムコールを呼ばないのですべてユーザーモードで動作している。

なので、 `%user` の値が大きくなる。

```
$ cc -o loop loop.c
$ ./loop &
[1] 890
$ sar -P ALL 1 1
Linux 4.9.184-linuxkit (4666df79cfec) 	04/17/20 	_x86_64_	(6 CPU)

13:51:28        CPU     %user     %nice   %system   %iowait    %steal     %idle
13:51:29        all     18.18      0.00      2.06      0.00      0.00     79.76
13:51:29          0     93.00      0.00      2.00      0.00      0.00      5.00
13:51:29          1      2.11      0.00      1.05      0.00      0.00     96.84
13:51:29          2      3.03      0.00      3.03      0.00      0.00     93.94
13:51:29          3      2.06      0.00      0.00      0.00      0.00     97.94
13:51:29          4      6.12      0.00      5.10      0.00      0.00     88.78
13:51:29          5      0.00      0.00      1.06      0.00      0.00     98.94

Average:        CPU     %user     %nice   %system   %iowait    %steal     %idle
Average:        all     18.18      0.00      2.06      0.00      0.00     79.76
Average:          0     93.00      0.00      2.00      0.00      0.00      5.00
Average:          1      2.11      0.00      1.05      0.00      0.00     96.84
Average:          2      3.03      0.00      3.03      0.00      0.00     93.94
Average:          3      2.06      0.00      0.00      0.00      0.00     97.94
Average:          4      6.12      0.00      5.10      0.00      0.00     88.78
Average:          5      0.00      0.00      1.06      0.00      0.00     98.94
$ kill 890
```

p.20

```
$ cc -o ppidloop ppidloop.c
$ ./ppidloop &
[1] 904
$ sar -P ALL 1 1
Linux 4.9.184-linuxkit (4666df79cfec) 	04/17/20 	_x86_64_	(6 CPU)

13:59:10        CPU     %user     %nice   %system   %iowait    %steal     %idle
13:59:11        all     12.16      0.00      8.22      0.00      0.00     79.62
13:59:11          0      0.00      0.00      2.08      0.00      0.00     97.92
13:59:11          1      2.08      0.00      0.00      0.00      0.00     97.92
13:59:11          2      2.06      0.00      2.06      0.00      0.00     95.88
13:59:11          3      2.02      0.00      4.04      0.00      0.00     93.94
13:59:11          4     63.00      0.00     37.00      0.00      0.00      0.00
13:59:11          5      2.08      0.00      3.12      0.00      0.00     94.79

Average:        CPU     %user     %nice   %system   %iowait    %steal     %idle
Average:        all     12.16      0.00      8.22      0.00      0.00     79.62
Average:          0      0.00      0.00      2.08      0.00      0.00     97.92
Average:          1      2.08      0.00      0.00      0.00      0.00     97.92
Average:          2      2.06      0.00      2.06      0.00      0.00     95.88
Average:          3      2.02      0.00      4.04      0.00      0.00     93.94
Average:          4     63.00      0.00     37.00      0.00      0.00      0.00
Average:          5      2.08      0.00      3.12      0.00      0.00     94.79
$ kill 904
```
